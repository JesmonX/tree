<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Folder Tree Viewer</title>
<style>
    body {
        font-family: Menlo, Consolas, monospace;
        background: #f4f4f4;
        padding: 20px;
    }
    #tree ul {
        list-style-type: none;
        padding-left: 20px;
    }
    .folder::before { content: "ğŸ“ "; }
    .file::before   { content: "ğŸ“„ "; }
    li { cursor: pointer; line-height: 22px; }

    #picker {
        padding: 15px 20px;
        background: #ddd;
        border-radius: 8px;
        display: inline-block;
        cursor: pointer;
        margin-right: 20px;
    }

    #buttons {
        margin-top: 10px;
        margin-bottom: 20px;
    }

    .action-btn {
        padding: 8px 14px;
        border-radius: 6px;
        border: none;
        background: #bbb;
        cursor: pointer;
        margin-right: 8px;
    }
    .action-btn:hover {
        background: #aaa;
    }
</style>
</head>

<body>

<h2>ğŸ“ Folder Tree Viewer</h2>

<label id="picker">
    ğŸ‘‰ ç‚¹å‡»é€‰æ‹©æ–‡ä»¶å¤¹
    <input id="dirPicker" type="file" webkitdirectory multiple style="display:none">
</label>

<div id="buttons" style="display:none;">
    <button id="showFolders" class="action-btn">åªæ˜¾ç¤ºæ–‡ä»¶å¤¹</button>
    <button id="showAll" class="action-btn">æ˜¾ç¤ºå…¨éƒ¨</button>
</div>

<div id="tree"></div>

<script>
let FULL_TREE = null;  // å®Œæ•´çš„æ ‘ç»“æ„ï¼ˆæ–‡ä»¶ + æ–‡ä»¶å¤¹ï¼‰

document.getElementById("dirPicker").addEventListener("change", function(e) {
    const files = e.target.files;
    FULL_TREE = buildTree(files); // ä¿å­˜å®Œæ•´æ ‘
    renderTree(FULL_TREE, false);  // é»˜è®¤æ˜¾ç¤ºå…¨éƒ¨

    document.getElementById("buttons").style.display = "block";
});

// -------------------------
// æ„å»ºæ ‘ï¼ˆä»æ–‡ä»¶è·¯å¾„è§£æï¼‰
// -------------------------
function buildTree(files) {
    const root = {};

    for (let file of files) {
        const parts = file.webkitRelativePath.split("/");
        let node = root;

        for (let i = 0; i < parts.length; i++) {
            const part = parts[i];
            if (!node[part]) node[part] = {};
            node = node[part];
        }
    }
    return root;
}

// -------------------------
// æ¸²æŸ“æ ‘ï¼ˆæ”¯æŒè¿‡æ»¤ï¼‰
// -------------------------
function renderTree(treeRoot, foldersOnly) {
    const container = document.getElementById("tree");
    container.innerHTML = "";

    function buildList(node) {
        const ul = document.createElement("ul");

        for (let name in node) {
            const children = node[name];
            const isLeaf = Object.keys(children).length === 0;

            if (foldersOnly && isLeaf) continue; // è¿‡æ»¤æ‰æ–‡ä»¶

            const li = document.createElement("li");
            li.textContent = name;
            li.className = isLeaf ? "file" : "folder";

            const childUl = buildList(children);

            if (!isLeaf) {
                li.onclick = function(e) {
                    e.stopPropagation();
                    childUl.style.display =
                        childUl.style.display === "none" ? "block" : "none";
                };
            }

            li.appendChild(childUl);
            ul.appendChild(li);
        }
        return ul;
    }

    container.appendChild(buildList(treeRoot));
}

// -------------------------
// æŒ‰é’®åŠŸèƒ½ï¼šåªæ˜¾ç¤ºæ–‡ä»¶å¤¹
// -------------------------
document.getElementById("showFolders").onclick = function() {
    if (FULL_TREE) renderTree(FULL_TREE, true);
};

// -------------------------
// æŒ‰é’®åŠŸèƒ½ï¼šæ˜¾ç¤ºå…¨éƒ¨
// -------------------------
document.getElementById("showAll").onclick = function() {
    if (FULL_TREE) renderTree(FULL_TREE, false);
};
</script>

</body>
</html>
